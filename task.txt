Task Description
Build the page below using Beego and Vanilla Javascript l
Task Breakdown
1. Visit h5ps://thecatapi.com and implement same feature previewed
2. Use vanilla JS as you preferred for frontend interaction
3. Use beego for controller, template rendering
4. Use go channel for API calls (MUST)
5. Utilize beego conﬁg for API key and other conﬁguration
6. Write Unit tests for achieve 80% Code Coverage


***************************************
go test ./tests -v
go get .out
******************************************
func TestFetchBreedWithImages(t *testing.T) {
    setupMockConfig() // Ensure mock configuration is set

    ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        if r.URL.Path == "/v1/breeds/abys" {
            json.NewEncoder(w).Encode(mockBreed)
        } else if r.URL.Path == "/v1/images/search" {
            mockImages := []struct {
                URL string `json:"url"`
            }{
                {URL: "http://example.com/cat1.jpg"},
                {URL: "http://example.com/cat2.jpg"},
            }
            json.NewEncoder(w).Encode(mockImages)
        } else {
            t.Errorf("Unexpected request to path: %s", r.URL.Path)
        }
    }))
    defer ts.Close()

    // Override API endpoints
    oldBreedDetailsURL := fetchBreedDetailsURL
    oldBreedImagesURL := fetchBreedImagesURL
    fetchBreedDetailsURL = ts.URL
    fetchBreedImagesURL = ts.URL
    defer func() {
        fetchBreedDetailsURL = oldBreedDetailsURL
        fetchBreedImagesURL = oldBreedImagesURL
    }()

    r, _ := http.NewRequest("GET", "/cat/fetch_breeds?id=abys", nil)
    w := httptest.NewRecorder()

    ctx := context.NewContext()
    ctx.Reset(w, r)

    controller := &controllers.CatController{}
    controller.Init(ctx, "CatController", "CatController", nil)
    controller.Ctx.Input.SetParam("id", "abys")

    controller.FetchBreeds()

    // Check response
    if w.Code != http.StatusOK {
        t.Errorf("Expected status code %d, got %d", http.StatusOK, w.Code)
    }

    var response map[string]interface{}
    err := json.Unmarshal(w.Body.Bytes(), &response)
    if err != nil {
        t.Errorf("Failed to unmarshal response: %v", err)
    }

    if response["BreedDetails"] == nil {
        t.Error("Expected BreedDetails in response")
    }
    if response["BreedImages"] == nil {
        t.Error("Expected BreedImages in response")
    }
}
***********************************
func TestShowFavoriteImages(t *testing.T) {
	// Mock response from the API
	mockResponse := `[{"id":1, "image_id":"img123", "created_at":"2024-12-25"}]`
	req, err := http.NewRequest("GET", "/cat/fav_pics", nil)
	if err != nil {
		t.Fatal(err)
	}

	// Mock the API call (this is a simple mock example)
	// In real test, you may use a mock package like github.com/stretchr/testify/mock to mock the http client
	req.Header.Set("x-api-key", "test_api_key")

	rr := httptest.NewRecorder()
	handler := http.HandlerFunc(controllers.ShowFavoriteImages)
	handler.ServeHTTP(rr, req)

	// Check if the response is successful
	assert.Equal(t, rr.Code, http.StatusOK)

	// Check the response body for expected data
	var response []map[string]interface{}
	json.NewDecoder(rr.Body).Decode(&response)

	assert.Equal(t, len(response), 1)
	assert.Equal(t, response[0]["image_id"], "img123")
}

func TestShowFavoriteImages_APIError(t *testing.T) {
	// Simulate an API error
	req, err := http.NewRequest("GET", "/cat/fav_pics", nil)
	if err != nil {
		t.Fatal(err)
	}

	// Mock an API failure, for example, 401 Unauthorized
	rr := httptest.NewRecorder()
	handler := http.HandlerFunc(controllers.ShowFavoriteImages)
	handler.ServeHTTP(rr, req)

	// Check if the status is 500 Internal Server Error due to API failure
	assert.Equal(t, rr.Code, http.StatusInternalServerError)
	var response map[string]string
	json.NewDecoder(rr.Body).Decode(&response)
	assert.Contains(t, response["error"], "Failed to fetch")
}
*********************************************
func TestDeleteFavoriteImage(t *testing.T) {
	// Mock response from the API
	req, err := http.NewRequest("DELETE", "/cat/delete_fav/12345", nil)
	if err != nil {
		t.Fatal(err)
	}

	// Simulate the request to the controller
	rr := httptest.NewRecorder()
	handler := http.HandlerFunc(controllers.DeleteFavoriteImage)
	handler.ServeHTTP(rr, req)

	// Check if status code is 200 OK
	assert.Equal(t, rr.Code, http.StatusOK)
	var response map[string]string
	json.NewDecoder(rr.Body).Decode(&response)
	assert.Equal(t, response["message"], "Favorite deleted successfully!")
}

func TestDeleteFavoriteImage_NotFound(t *testing.T) {
	// Simulate a failure when deleting
	req, err := http.NewRequest("DELETE", "/cat/delete_fav/nonexistent_id", nil)
	if err != nil {
		t.Fatal(err)
	}

	// Simulate the request to the controller
	rr := httptest.NewRecorder()
	handler := http.HandlerFunc(controllers.DeleteFavoriteImage)
	handler.ServeHTTP(rr, req)

	// Check if status code is 400 or some error code
	assert.Equal(t, rr.Code, http.StatusOK)
	var response map[string]string
	json.NewDecoder(rr.Body).Decode(&response)
	assert.Equal(t, response["message"], "Failed to delete favorite.")
}

